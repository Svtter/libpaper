# LibPaper 第一阶段开发计划

## 阶段目标

实现 LibPaper 的核心基础功能，为后续扩展打下坚实基础。第一阶段专注于：

- **PDF 文件存储管理**: 安全存储 PDF 文件并记录存储位置
- **文件分类系统**: 支持层次化的文件夹/分类组织
- **标签管理**: 灵活的多标签系统
- **CLI 工具**: 完整的命令行界面

## 功能清单

### 核心功能 (必须完成)

#### 1. 数据模型和存储

- [x] Paper 文献模型定义
- [ ] Collection 分类模型定义
- [ ] Tag 标签模型定义
- [ ] SQLite 数据库设计和初始化
- [ ] 数据库迁移系统

#### 2. 文件存储管理

- [ ] 文件哈希计算 (SHA256)
- [ ] 重复文件检测
- [ ] 分层存储结构 (年/月)
- [ ] 文件复制和移动
- [ ] 存储空间统计

#### 3. PDF 元数据提取

- [ ] 基础 PDF 信息提取 (标题、作者等)
- [ ] PDF 文件验证
- [ ] 元数据缓存机制

#### 4. 文献管理服务

- [ ] 添加文献 (本地 PDF 文件)
- [ ] 查询文献 (按 ID、标题、作者等)
- [ ] 更新文献信息
- [ ] 删除文献 (包括文件)
- [ ] 批量操作支持

#### 5. 分类管理服务

- [ ] 创建分类
- [ ] 层次化分类结构
- [ ] 文献分类关联
- [ ] 分类统计信息
- [ ] 删除分类

#### 6. 标签管理服务

- [ ] 创建标签
- [ ] 标签颜色管理
- [ ] 文献标签关联
- [ ] 标签统计信息
- [ ] 删除标签

#### 7. CLI 命令界面

- [ ] 项目初始化命令
- [ ] 文献管理命令组
- [ ] 分类管理命令组
- [ ] 标签管理命令组
- [ ] 配置管理命令
- [ ] 数据库维护命令

### 增强功能 (时间允许)

#### 8. 搜索功能

- [ ] 基础文本搜索
- [ ] 多字段组合搜索
- [ ] 搜索结果排序

#### 9. 数据导入导出

- [ ] BibTeX 格式导出
- [ ] 批量文件导入
- [ ] 数据备份和恢复

#### 10. 配置和优化

- [ ] 配置文件管理
- [ ] 性能监控
- [ ] 错误日志记录

## 实现步骤

### Week 1: 基础架构

**目标**: 建立项目基础结构和数据模型

**任务列表**:

1. **数据模型实现** (2 天)

   - 完成 Paper、Collection、Tag 模型
   - 添加数据验证和类型检查
   - 单元测试覆盖

2. **数据库设计** (2 天)

   - SQLite 数据库表结构
   - 数据库连接和操作类
   - 数据库初始化和迁移

3. **配置系统** (1 天)
   - 配置文件结构设计
   - 环境变量支持
   - 默认配置设置

**验收标准**:

- [ ] 所有数据模型通过类型检查
- [ ] 数据库可以正常创建和连接
- [ ] 配置系统可以正确加载设置

### Week 2: 核心服务

**目标**: 实现核心业务逻辑

**任务列表**:

1. **文件存储管理** (3 天)

   - 文件哈希计算和验证
   - 存储路径生成和管理
   - 文件复制和删除操作
   - 重复文件处理

2. **PDF 元数据提取** (2 天)
   - 使用 pypdf 提取基础信息
   - 错误处理和文件验证
   - 元数据格式标准化

**验收标准**:

- [ ] 可以安全存储和管理 PDF 文件
- [ ] 能够提取 PDF 基础元数据
- [ ] 重复文件能被正确识别

### Week 3: 业务服务层

**目标**: 实现文献、分类、标签管理服务

**任务列表**:

1. **文献管理服务** (3 天)

   - PaperService 类实现
   - CRUD 操作完整实现
   - 批量操作支持

2. **分类和标签服务** (2 天)
   - CollectionService 和 TagService
   - 关联关系管理
   - 统计信息计算

**验收标准**:

- [ ] 可以完整管理文献生命周期
- [ ] 分类和标签系统正常工作
- [ ] 数据一致性得到保证

### Week 4: CLI 界面

**目标**: 实现完整的命令行界面

**任务列表**:

1. **CLI 框架搭建** (2 天)

   - Click 命令组织结构
   - Rich 输出美化
   - 错误处理和用户反馈

2. **命令实现** (3 天)
   - 文献管理命令 (add, list, show, remove)
   - 分类管理命令 (create, list, add, remove)
   - 标签管理命令 (create, list, add, remove)
   - 系统命令 (init, config, db)

**验收标准**:

- [ ] 所有基础命令正常工作
- [ ] 用户界面友好且信息丰富
- [ ] 错误信息清晰易懂

## 技术规范

### 代码质量要求

- **类型提示**: 所有函数和方法必须有完整的类型提示
- **文档字符串**: 所有公共 API 必须有中文文档字符串
- **错误处理**: 适当的异常处理和用户友好的错误信息
- **测试覆盖**: 核心功能需要单元测试覆盖

### 性能要求

- **文件操作**: 支持大文件 (>100MB) 的处理
- **数据库查询**: 单次查询响应时间 < 100ms
- **内存使用**: 常驻内存 < 50MB

### 兼容性要求

- **Python 版本**: Python 3.12+
- **操作系统**: Linux、macOS、Windows
- **数据库**: SQLite 3.35+

## 里程碑

### Milestone 1: 核心架构完成 (Week 1 结束)

- 数据模型和数据库就绪
- 基础配置系统工作
- 项目结构清晰

### Milestone 2: 文件管理就绪 (Week 2 结束)

- PDF 文件可以安全存储
- 元数据提取正常工作
- 重复检测功能完善

### Milestone 3: 业务逻辑完成 (Week 3 结束)

- 所有核心服务实现
- 数据操作稳定可靠
- API 接口设计合理

### Milestone 4: MVP 发布 (Week 4 结束)

- CLI 工具完全可用
- 基础功能测试通过
- 用户文档完备

## 风险评估

### 高风险项

1. **PDF 解析复杂性**: 不同 PDF 格式的兼容性问题

   - **缓解措施**: 使用成熟的 pypdf 库，添加错误处理

2. **文件存储性能**: 大量文件的存储和检索性能
   - **缓解措施**: 分层存储，索引优化

### 中风险项

1. **数据库迁移**: SQLite 数据库结构变更

   - **缓解措施**: 设计版本化迁移系统

2. **跨平台兼容**: 不同操作系统的路径处理
   - **缓解措施**: 使用 pathlib，充分测试

## 后续规划

第一阶段完成后，将进入第二阶段开发：

- **全文搜索**: 基于内容的搜索引擎
- **在线集成**: DOI、CrossRef 等外部数据源
- **数据同步**: 与 Zotero、Mendeley 等工具集成
- **Web API**: RESTful API 接口
- **高级功能**: 智能分类、引用分析等
